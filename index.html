<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#76b852">
    <meta name="description" content="Michigan mushroom identification game - Learn to forage safely!">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üçÑ</text></svg>">
    <title>üçÑ Mushroom Hunter - Michigan Foraging Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #e8e8e8;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        header {
            text-align: center;
            padding: 30px 0;
        }

        header h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #76b852, #8dc26f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        header p {
            color: #888;
            font-size: 1.1rem;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #76b852;
        }

        .stat-label {
            font-size: 0.8rem;
            color: #888;
            text-transform: uppercase;
        }

        .game-card {
            background: rgba(255,255,255,0.08);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .mushroom-display {
            text-align: center;
            margin-bottom: 25px;
        }

        .mushroom-emoji {
            font-size: 8rem;
            margin-bottom: 15px;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.3));
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .mushroom-name {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .mushroom-scientific {
            font-style: italic;
            color: #888;
            margin-bottom: 15px;
        }

        .mushroom-description {
            color: #aaa;
            line-height: 1.6;
            max-width: 500px;
            margin: 0 auto;
        }

        .question {
            text-align: center;
            font-size: 1.3rem;
            margin: 25px 0;
            color: #ddd;
        }

        .choices {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            max-width: 500px;
            margin: 0 auto;
        }

        .choice-btn {
            padding: 18px 25px;
            font-size: 1.1rem;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            background: rgba(255,255,255,0.05);
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .choice-btn:hover {
            background: rgba(255,255,255,0.15);
            border-color: rgba(255,255,255,0.4);
            transform: translateY(-2px);
        }

        .choice-btn.correct {
            background: rgba(76, 175, 80, 0.3);
            border-color: #4caf50;
            animation: pulse-green 0.5s ease;
        }

        .choice-btn.wrong {
            background: rgba(244, 67, 54, 0.3);
            border-color: #f44336;
            animation: shake 0.5s ease;
        }

        @keyframes pulse-green {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .result-card {
            text-align: center;
            padding: 20px;
            border-radius: 12px;
            margin-top: 20px;
            display: none;
        }

        .result-card.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes confetti {
            0% { transform: translateY(-100%) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            top: -10px;
            animation: confetti 3s ease-out forwards;
            z-index: 1000;
        }

        @keyframes timerPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .timer-urgent {
            animation: timerPulse 0.5s infinite;
            color: #f44336 !important;
        }

        .result-card.correct {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid rgba(76, 175, 80, 0.4);
        }

        .result-card.wrong {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid rgba(244, 67, 54, 0.4);
        }

        .result-title {
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .fun-fact {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            text-align: left;
        }

        .fun-fact h4 {
            color: #76b852;
            margin-bottom: 8px;
        }

        .next-btn {
            margin-top: 20px;
            padding: 15px 40px;
            font-size: 1.1rem;
            background: linear-gradient(90deg, #76b852, #8dc26f);
            border: none;
            border-radius: 30px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .next-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 20px rgba(118, 184, 82, 0.4);
        }

        .game-over {
            text-align: center;
            padding: 40px;
        }

        .game-over h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            background: linear-gradient(90deg, #76b852, #8dc26f);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .final-score {
            font-size: 4rem;
            font-weight: bold;
            color: #76b852;
            margin: 20px 0;
        }

        .grade {
            font-size: 1.5rem;
            margin-bottom: 30px;
        }

        .grade-title {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .play-again-btn {
            padding: 18px 50px;
            font-size: 1.2rem;
            background: linear-gradient(90deg, #76b852, #8dc26f);
            border: none;
            border-radius: 30px;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .play-again-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 25px rgba(118, 184, 82, 0.5);
        }

        .start-screen {
            text-align: center;
            padding: 50px 20px;
        }

        .start-screen h2 {
            font-size: 2rem;
            margin-bottom: 20px;
        }

        .start-screen p {
            color: #aaa;
            margin-bottom: 30px;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }

        .difficulty-select {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
        }

        .difficulty-btn {
            padding: 12px 25px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            background: transparent;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .difficulty-btn.active {
            background: rgba(118, 184, 82, 0.3);
            border-color: #76b852;
        }

        .difficulty-btn:hover {
            border-color: rgba(255,255,255,0.5);
        }

        .warning-box {
            background: rgba(255, 152, 0, 0.2);
            border: 1px solid rgba(255, 152, 0, 0.4);
            border-radius: 10px;
            padding: 15px;
            margin: 20px auto;
            max-width: 500px;
        }

        .warning-box h4 {
            color: #ff9800;
            margin-bottom: 5px;
        }

        .warning-box p {
            color: #ddd;
            font-size: 0.9rem;
            margin: 0;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            margin-bottom: 20px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #76b852, #8dc26f);
            transition: width 0.3s ease;
        }

        @media (max-width: 600px) {
            header h1 { font-size: 1.8rem; }
            .mushroom-emoji { font-size: 5rem; }
            .choices { grid-template-columns: 1fr; }
            .stats-bar { flex-wrap: wrap; gap: 15px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üçÑ Mushroom Hunter</h1>
            <p>Michigan Foraging Identification Game</p>
        </header>

        <div id="app"></div>
    </div>

    <script>
        // Michigan Mushroom Database
        const mushrooms = [
            {
                name: "Morel",
                scientific: "Morchella esculenta",
                emoji: "üçÑ",
                appearance: "Honeycomb-like cap with ridges and pits, hollow inside, cream to dark brown color",
                habitat: "Found near dying elm, ash, and apple trees in spring (April-May)",
                answer: "edible",
                funFact: "Morels are Michigan's most prized wild mushroom! They can sell for $30-50 per pound. The key to finding them: look near dead or dying elm and ash trees after a warm spring rain when soil temps hit 50¬∞F.",
                difficulty: 1
            },
            {
                name: "Destroying Angel",
                scientific: "Amanita bisporigera",
                emoji: "üçÑ",
                appearance: "Pure white cap and stem, with a skirt-like ring and bulbous base with a cup (volva)",
                habitat: "Hardwood and mixed forests, summer through fall",
                answer: "deadly",
                funFact: "One of the deadliest mushrooms in North America! Contains amatoxins that cause liver failure. Just half a cap can be lethal. It's responsible for 90% of mushroom-related deaths. NEVER eat an all-white mushroom without expert identification!",
                difficulty: 1
            },
            {
                name: "Chicken of the Woods",
                scientific: "Laetiporus sulphureus",
                emoji: "üçÑ",
                appearance: "Bright orange and yellow shelf fungus, grows in overlapping clusters on trees",
                habitat: "On dead or dying oak, cherry, and other hardwoods",
                answer: "edible",
                funFact: "Named for its chicken-like texture when cooked! Best when young and tender. In Michigan, look for it from late summer through fall on oak trees. Some people are sensitive to it, so try a small amount first.",
                difficulty: 1
            },
            {
                name: "Jack O'Lantern",
                scientific: "Omphalotus olearius",
                emoji: "üçÑ",
                appearance: "Bright orange, grows in clusters at base of trees, gills glow faintly in the dark",
                habitat: "At the base of hardwood trees and stumps, late summer to fall",
                answer: "poisonous",
                funFact: "Often mistaken for edible Chanterelles! Key differences: Jack O'Lanterns grow in clusters on wood, have true gills, and actually glow in the dark (bioluminescence). Chanterelles grow from soil and have false gills. Causes severe GI distress but isn't deadly.",
                difficulty: 2
            },
            {
                name: "Giant Puffball",
                scientific: "Calvatia gigantea",
                emoji: "‚ö™",
                appearance: "Large white ball, can grow to soccer-ball size or larger, no stem, smooth surface",
                habitat: "Meadows, pastures, and open woods, late summer to fall",
                answer: "edible",
                funFact: "A single giant puffball can contain 7 TRILLION spores! Edible only when interior is pure white - if it's yellow or brown, it's past prime. Slice it like bread and fry in butter. Some specimens in Michigan have been found weighing over 40 pounds!",
                difficulty: 1
            },
            {
                name: "False Morel",
                scientific: "Gyromitra esculenta",
                emoji: "üçÑ",
                appearance: "Brain-like, wrinkled cap (not honeycomb), reddish-brown, stem is chambered not hollow",
                habitat: "Sandy soils near conifers, early spring",
                answer: "poisonous",
                funFact: "Contains gyromitrin which converts to toxic monomethylhydrazine (rocket fuel!) in your body. While some people eat them after special preparation, it's caused deaths. The key difference from true morels: brain-like wrinkles vs honeycomb pits, and chambered vs hollow stem.",
                difficulty: 2
            },
            {
                name: "Chanterelle",
                scientific: "Cantharellus cibarius",
                emoji: "üçÑ",
                appearance: "Golden yellow, funnel-shaped with wavy edges, false gills (ridges), fruity apricot smell",
                habitat: "Near oaks and conifers in moss, summer through fall",
                answer: "edible",
                funFact: "Chanterelles have a distinctive apricot-like aroma! They form mycorrhizal relationships with trees and can't be cultivated commercially. In Michigan, look in oak forests after summer rains. They're among the world's most popular wild edible mushrooms.",
                difficulty: 2
            },
            {
                name: "Fly Agaric",
                scientific: "Amanita muscaria",
                emoji: "üçÑ",
                appearance: "Iconic red cap with white spots, white gills, white stem with ring and bulbous base",
                habitat: "Under birch and pine trees, late summer to fall",
                answer: "poisonous",
                funFact: "The classic 'Mario mushroom' and fairy tale toadstool! Contains ibotenic acid and muscimol - causes delirium, not death (though still dangerous). Vikings may have used it for 'berserker' rage. It's been used in shamanic rituals for thousands of years.",
                difficulty: 1
            },
            {
                name: "Hen of the Woods",
                scientific: "Grifola frondosa",
                emoji: "üçÑ",
                appearance: "Large cluster of grayish-brown overlapping fan-shaped caps, grows at tree bases",
                habitat: "Base of oaks, especially old or dying trees, fall",
                answer: "edible",
                funFact: "Also called Maitake ('dancing mushroom' in Japanese)! Highly prized in both cooking and traditional medicine. A single cluster can weigh 50+ pounds. In Michigan, oak forests in fall are prime hunting grounds. The same spot often produces year after year!",
                difficulty: 2
            },
            {
                name: "Death Cap",
                scientific: "Amanita phalloides",
                emoji: "üçÑ",
                appearance: "Greenish-yellow to olive cap, white gills, white stem with skirt ring and cup at base",
                habitat: "Under oaks, introduced species becoming more common",
                answer: "deadly",
                funFact: "Responsible for most fatal mushroom poisonings worldwide! Symptoms don't appear for 6-12 hours, by which time liver damage is underway. There's no antidote - only liver transplant can save victims in severe cases. Originally European, now spreading in North America.",
                difficulty: 2
            },
            {
                name: "Oyster Mushroom",
                scientific: "Pleurotus ostreatus",
                emoji: "üçÑ",
                appearance: "Fan or oyster-shaped caps, white to gray to brown, short offset stem, white gills",
                habitat: "On dead hardwoods, especially in cooler weather, spring and fall",
                answer: "edible",
                funFact: "One of the easiest wild mushrooms to identify and one of the safest for beginners! They're also one of few mushrooms that are carnivorous - they trap and digest nematodes for nitrogen. Great beginner foraging mushroom in Michigan!",
                difficulty: 1
            },
            {
                name: "Lion's Mane",
                scientific: "Hericium erinaceus",
                emoji: "ü¶Å",
                appearance: "White, shaggy mass of cascading spines, no cap or gills, looks like a white pom-pom",
                habitat: "On dead or dying hardwoods, especially beech and maple, late summer to fall",
                answer: "edible",
                funFact: "Looks like a white waterfall! Studies show it may support brain health and nerve regeneration. Has a seafood-like taste similar to crab or lobster. No poisonous lookalikes make this a great beginner mushroom. Increasingly rare in the wild.",
                difficulty: 1
            },
            {
                name: "Earthball",
                scientific: "Scleroderma citrinum",
                emoji: "üü§",
                appearance: "Round like a puffball but with thick rubbery skin, interior is dark purple-black when cut",
                habitat: "Woodland paths and disturbed areas, summer to fall",
                answer: "poisonous",
                funFact: "Often mistaken for edible puffballs! The key difference: cut it open. Puffballs should be pure white inside like marshmallow. Earthballs have dark purple-black interiors even when young. Causes severe gastrointestinal upset.",
                difficulty: 2
            },
            {
                name: "Reishi",
                scientific: "Ganoderma lucidum",
                emoji: "üçÑ",
                appearance: "Kidney-shaped, shiny reddish-brown lacquered surface, grows as shelf on trees",
                habitat: "On hardwoods, especially oaks and maples, year-round",
                answer: "medicinal",
                funFact: "The 'Mushroom of Immortality' in Chinese medicine for over 2,000 years! Too woody to eat but used to make tea or extracts. Contains compounds being studied for immune support. Michigan's forests have several Ganoderma species.",
                difficulty: 2
            },
            {
                name: "Shaggy Mane",
                scientific: "Coprinus comatus",
                emoji: "üçÑ",
                appearance: "Tall white cylinder with shaggy scales, dissolves into black ink from bottom up when mature",
                habitat: "Disturbed ground, lawns, paths, roadsides, spring and fall",
                answer: "edible",
                funFact: "Must be eaten within hours of picking - it autodigests into black ink! The 'inky cap' process is called deliquescence. Best when young before the gills turn pink. Never consume alcohol within 3 days of eating any inky cap mushrooms!",
                difficulty: 2
            },
            {
                name: "Turkey Tail",
                scientific: "Trametes versicolor",
                emoji: "ü¶É",
                appearance: "Thin, flexible, fan-shaped brackets with colorful concentric zones like turkey feathers",
                habitat: "On dead hardwood logs and stumps, year-round",
                answer: "medicinal",
                funFact: "One of the most researched medicinal mushrooms! Contains PSK, used alongside cancer treatment in Japan. Too tough to eat but great for tea. The most common bracket fungus in Michigan - you've probably walked past thousands!",
                difficulty: 1
            },
            {
                name: "Black Trumpet",
                scientific: "Craterellus cornucopioides",
                emoji: "üñ§",
                appearance: "Funnel-shaped, thin-fleshed, dark gray to black, no gills, wavy edges",
                habitat: "In moss under oaks and beeches, summer to fall",
                answer: "edible",
                funFact: "Called 'black gold' by foragers! Despite the ominous appearance, they're delicious with an earthy, smoky flavor. Hard to spot - they blend into leaf litter. Nicknamed 'trompette de la mort' (trumpet of death) in French, but totally safe to eat!",
                difficulty: 2,
                season: [7, 8, 9]
            },
            {
                name: "Beefsteak Fungus",
                scientific: "Fistulina hepatica",
                emoji: "ü•©",
                appearance: "Thick, tongue-shaped bracket, blood-red and meaty looking, oozes red juice when cut",
                habitat: "On oaks and chestnuts, late summer to fall",
                answer: "edible",
                funFact: "Looks disturbingly like raw meat - even 'bleeds' red juice! Has a sour, tangy taste due to vitamin C content. In England, it's called 'ox tongue.' The wood it grows on becomes valuable 'brown oak' prized by woodworkers!",
                difficulty: 2,
                season: [8, 9, 10]
            },
            {
                name: "Deadly Galerina",
                scientific: "Galerina marginata",
                emoji: "üçÑ",
                appearance: "Small brown cap, brown gills, thin stem with faint ring, grows on wood",
                habitat: "On rotting wood, especially conifers, spring through fall",
                answer: "deadly",
                funFact: "Contains the same deadly amatoxins as Death Cap! Often mistaken for psychedelic Psilocybe mushrooms or edible Honey Mushrooms. Small but lethal - just a few can kill. Always check for wood substrate and do a spore print!",
                difficulty: 2,
                season: [4, 5, 6, 7, 8, 9, 10]
            },
            {
                name: "Honey Mushroom",
                scientific: "Armillaria mellea",
                emoji: "üçØ",
                appearance: "Honey-brown cap, white gills, ring on stem, grows in clusters at tree bases",
                habitat: "At base of trees and stumps, fall",
                answer: "edible",
                funFact: "One of the largest living organisms on Earth! A single Honey Mushroom colony in Oregon covers 2,385 acres and is estimated to be 2,400 years old. Must be cooked thoroughly - raw ones cause stomach upset. Great in stir-fries!",
                difficulty: 2,
                season: [9, 10, 11]
            },
            {
                name: "Chaga",
                scientific: "Inonotus obliquus",
                emoji: "‚¨õ",
                appearance: "Black, burnt-looking crusty growth on birch trees, interior is orange-brown",
                habitat: "On living birch trees, year-round",
                answer: "medicinal",
                funFact: "Not actually a mushroom but a sclerotia (mass of mycelium)! Used in Siberian folk medicine for centuries. Takes 5-7 years to mature. Harvesting kills the colony - please harvest sustainably! Makes a pleasant tea with vanilla notes.",
                difficulty: 2,
                season: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]
            },
            {
                name: "Angel Wings",
                scientific: "Pleurocybella porrigens",
                emoji: "üëº",
                appearance: "Pure white, thin, fan-shaped, no stem, grows in overlapping shelves on conifers",
                habitat: "On dead conifer logs, especially hemlock, fall",
                answer: "poisonous",
                funFact: "Was considered edible until 2004 when 59 people in Japan were poisoned, 17 fatally! Now known to cause fatal brain damage in people with kidney problems. Looks similar to Oyster Mushrooms but grows on conifers, not hardwoods.",
                difficulty: 2,
                season: [9, 10, 11]
            },
            {
                name: "Indigo Milk Cap",
                scientific: "Lactarius indigo",
                emoji: "üîµ",
                appearance: "Striking blue color, exudes blue milk when cut, fades to grayish with age",
                habitat: "Under oaks and pines, summer to fall",
                answer: "edible",
                funFact: "One of the few blue foods in nature! The indigo color comes from azulene compounds. Taste is mildly peppery. Popular in Mexican and Guatemalan cuisine. When you cook it, the blue turns gray-green. Rare find in Michigan!",
                difficulty: 2,
                season: [7, 8, 9]
            },
            {
                name: "Parasol Mushroom",
                scientific: "Macrolepiota procera",
                emoji: "‚òÇÔ∏è",
                appearance: "Large (up to 12 inch cap), scaly brown cap, tall stem with moveable ring, snake-skin pattern on stem",
                habitat: "Meadows, pastures, forest edges, summer to fall",
                answer: "edible",
                funFact: "One of the largest and most elegant mushrooms! Cap can be breaded and fried like a schnitzel. The moveable ring is a key ID feature. Warning: has dangerous lookalikes in the Chlorophyllum genus that cause severe illness!",
                difficulty: 2,
                season: [7, 8, 9, 10]
            },
            {
                name: "Pear-shaped Puffball",
                scientific: "Apioperdon pyriforme",
                emoji: "üçê",
                appearance: "Small pear-shaped, white to tan, clustered on wood, tiny spines when young",
                habitat: "On dead logs and stumps in clusters, summer to fall",
                answer: "edible",
                funFact: "Unlike Giant Puffballs which grow from soil, these always grow on wood! Named for their pear shape. Same rule applies: only eat when interior is pure white. Often found in large clusters of dozens.",
                difficulty: 2,
                season: [7, 8, 9, 10]
            },
            {
                name: "Witch's Butter",
                scientific: "Tremella mesenterica",
                emoji: "üßà",
                appearance: "Bright yellow-orange, gelatinous, brain-like lobed mass",
                habitat: "On dead hardwood branches, year-round especially after rain",
                answer: "edible",
                funFact: "According to European folklore, if witch's butter appeared on your door, you'd been cursed! It's actually edible but flavorless - used in Asian soups for texture. It's not actually a decomposer - it parasitizes other fungi!",
                difficulty: 2,
                season: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
            },
            {
                name: "Chaga",
                scientific: "Inonotus obliquus",
                emoji: "‚¨õ",
                appearance: "Black, charcoal-like conk growing on birch trees, orange-brown inside",
                habitat: "Exclusively on birch trees, year-round",
                answer: "medicinal",
                funFact: "Called 'Black Gold' of the forest! Used for centuries in Siberian folk medicine. Not technically a mushroom - it's a sterile mass of mycelium. Sustainable harvesting is crucial as it takes 15-20 years to form. Extremely high in antioxidants.",
                difficulty: 2,
                season: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
            },
            {
                name: "Green-spored Parasol",
                scientific: "Chlorophyllum molybdites",
                emoji: "ü§¢",
                appearance: "Similar to Parasol but with GREEN spore print, large white cap with brown scales",
                habitat: "Lawns, parks, grassy areas, summer to fall",
                answer: "poisonous",
                funFact: "The most commonly consumed poisonous mushroom in North America! Looks like the edible Parasol but has GREEN spores. Causes severe vomiting and diarrhea. ALWAYS do a spore print on large lawn mushrooms!",
                difficulty: 3,
                season: [6, 7, 8, 9]
            },
            {
                name: "Dryad's Saddle",
                scientific: "Cerioporus squamosus",
                emoji: "üçÑ",
                appearance: "Large bracket with dark brown scales on cream background, smells like watermelon rind",
                habitat: "On dying hardwoods, especially box elder and elm, spring",
                answer: "edible",
                funFact: "Named because its saddle-shape could seat a wood nymph (dryad)! Only edible when young and tender - gets woody fast. Has a distinctive watermelon rind smell. One of the first polypores to appear in spring.",
                difficulty: 2,
                season: [3, 4, 5, 6]
            },
            {
                name: "Artist's Conk",
                scientific: "Ganoderma applanatum",
                emoji: "üé®",
                appearance: "Large woody bracket, brown top with white pore surface that bruises brown when touched",
                habitat: "On dead and dying hardwoods, perennial",
                answer: "medicinal",
                funFact: "The white pore surface permanently stains brown when scratched - artists use this to create drawings! Related to Reishi. Too woody to eat but used medicinally. Can live for decades, adding a new layer each year.",
                difficulty: 2,
                season: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11]
            },
            {
                name: "Candy Cap",
                scientific: "Lactarius rubidus",
                emoji: "üç¨",
                appearance: "Small reddish-brown cap, fragile, exudes milk when cut, distinct maple syrup smell when dried",
                habitat: "Under oaks and conifers, fall to winter",
                answer: "edible",
                funFact: "Smells exactly like maple syrup! Used to flavor desserts - cookies, ice cream, even candy. The maple aroma intensifies when dried. A prized gourmet species. Found mainly on West Coast but some Michigan relatives exist.",
                difficulty: 3,
                season: [10, 11, 0, 1]
            },
            {
                name: "Blue-staining Bolete",
                scientific: "Gyroporus cyanescens",
                emoji: "üíô",
                appearance: "Pale tan cap and stem, instantly stains intense blue when cut or bruised",
                habitat: "Under oaks and conifers in sandy soil, summer to fall",
                answer: "edible",
                funFact: "The dramatic blue staining is caused by oxidation of pulvinic acid! Despite the alarming color change, it's perfectly edible. Don't confuse with other bluing boletes - some are toxic. Check for no red pores (red = danger in boletes).",
                difficulty: 3,
                season: [7, 8, 9]
            }
        ];

        // Game State
        let currentMushroom = 0;
        let score = 0;
        let streak = 0;
        let questionsAnswered = 0;
        let shuffledMushrooms = [];
        let selectedDifficulty = 'all';
        let totalQuestions = 10;
        let survivalMode = false;
        let gameOver = false;

        // Achievements System
        const achievementDefs = [
            { id: 'first_hunt', name: 'First Hunt', desc: 'Complete your first game', icon: 'üå±', check: (stats) => stats.gamesPlayed >= 1 },
            { id: 'survivor', name: 'Survivor', desc: 'Complete Survival Mode without dying', icon: 'üí™', check: (stats) => stats.survivalWins >= 1 },
            { id: 'perfect_10', name: 'Perfect 10', desc: 'Score 100% on 10 questions', icon: 'üíØ', check: (stats) => stats.perfectGames >= 1 },
            { id: 'streak_5', name: 'Hot Streak', desc: 'Get 5 correct answers in a row', icon: 'üî•', check: (stats) => stats.maxStreak >= 5 },
            { id: 'streak_10', name: 'On Fire', desc: 'Get 10 correct answers in a row', icon: 'üî•üî•', check: (stats) => stats.maxStreak >= 10 },
            { id: 'deadly_expert', name: 'Death Defier', desc: 'Correctly identify all deadly mushrooms', icon: 'üíÄ', check: (stats) => stats.deadlyCorrect >= 3 },
            { id: 'morel_master', name: 'Morel Master', desc: 'Play during morel season (Apr-May)', icon: 'üëë', check: () => [3,4].includes(new Date().getMonth()) },
            { id: 'night_owl', name: 'Night Owl', desc: 'Play after 10pm', icon: 'ü¶â', check: () => new Date().getHours() >= 22 },
            { id: 'early_bird', name: 'Early Bird', desc: 'Play before 7am', icon: 'üê¶', check: () => new Date().getHours() < 7 },
            { id: 'scholar', name: 'Scholar', desc: 'View all mushrooms in Study Guide', icon: 'üìö', check: (stats) => stats.mushroomsViewed >= 32 },
            { id: 'centurion', name: 'Centurion', desc: 'Score over 100 points', icon: 'üèÜ', check: (stats) => stats.highScore >= 100 },
            { id: 'veteran', name: 'Veteran', desc: 'Play 10 games', icon: 'üéñÔ∏è', check: (stats) => stats.gamesPlayed >= 10 },
        ];

        function getStats() {
            const stats = localStorage.getItem('mushroomHunterStats');
            return stats ? JSON.parse(stats) : {
                gamesPlayed: 0,
                survivalWins: 0,
                perfectGames: 0,
                maxStreak: 0,
                deadlyCorrect: 0,
                mushroomsViewed: 0,
                highScore: 0,
                totalCorrect: 0,
                totalQuestions: 0
            };
        }

        function saveStats(stats) {
            localStorage.setItem('mushroomHunterStats', JSON.stringify(stats));
        }

        function getAchievements() {
            const achievements = localStorage.getItem('mushroomHunterAchievements');
            return achievements ? JSON.parse(achievements) : [];
        }

        function checkAchievements() {
            const stats = getStats();
            const earned = getAchievements();
            const newAchievements = [];
            
            achievementDefs.forEach(ach => {
                if (!earned.includes(ach.id) && ach.check(stats)) {
                    earned.push(ach.id);
                    newAchievements.push(ach);
                }
            });
            
            localStorage.setItem('mushroomHunterAchievements', JSON.stringify(earned));
            return newAchievements;
        }

        // Daily Challenge - same seed for everyone on same day
        function getDailySeed() {
            const today = new Date();
            return today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();
        }

        function seededRandom(seed) {
            const x = Math.sin(seed++) * 10000;
            return x - Math.floor(x);
        }

        function getDailyChallenge() {
            const seed = getDailySeed();
            const shuffled = [...mushrooms];
            
            // Fisher-Yates with seeded random
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(seededRandom(seed + i) * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            
            return shuffled.slice(0, 10);
        }

        function hasDoneDailyToday() {
            const lastDaily = localStorage.getItem('lastDailyChallenge');
            return lastDaily === getDailySeed().toString();
        }

        function markDailyComplete(score) {
            localStorage.setItem('lastDailyChallenge', getDailySeed().toString());
            localStorage.setItem('lastDailyScore', score.toString());
        }

        // High Scores
        function getHighScores() {
            const scores = localStorage.getItem('mushroomHunterScores');
            return scores ? JSON.parse(scores) : [];
        }

        function saveHighScore(score, mode) {
            const scores = getHighScores();
            scores.push({ score, mode, date: new Date().toLocaleDateString() });
            scores.sort((a, b) => b.score - a.score);
            localStorage.setItem('mushroomHunterScores', JSON.stringify(scores.slice(0, 10)));
        }

        // Seasonal data
        const monthNames = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        
        function getSeasonalMushrooms(month) {
            const monthNum = month + 1; // JS months are 0-indexed
            return mushrooms.filter(m => {
                if (!m.season) {
                    // Default seasons based on common knowledge
                    if (m.name === 'Morel') return [4, 5].includes(monthNum);
                    if (m.name.includes('Puffball')) return [8, 9, 10].includes(monthNum);
                    return [5, 6, 7, 8, 9, 10].includes(monthNum); // General mushroom season
                }
                return m.season.includes(monthNum);
            });
        }

        // Shuffle array
        function shuffle(array) {
            const arr = [...array];
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        // Get mushrooms based on difficulty
        function getMushroomsByDifficulty() {
            if (selectedDifficulty === 'all') return mushrooms;
            return mushrooms.filter(m => m.difficulty === parseInt(selectedDifficulty));
        }

        // Render start screen
        function renderStartScreen() {
            const highScores = getHighScores().slice(0, 5);
            const currentMonth = new Date().getMonth();
            const inSeason = getSeasonalMushrooms(currentMonth);
            
            document.getElementById('app').innerHTML = `
                <div class="game-card start-screen">
                    <h2>Welcome, Forager! üå≤</h2>
                    <p>Test your knowledge of Michigan's wild mushrooms. Can you tell the difference between a delicious Morel and a deadly Destroying Angel?</p>
                    
                    <div class="warning-box">
                        <h4>‚ö†Ô∏è Safety Warning</h4>
                        <p>This game is for education only. NEVER eat wild mushrooms without expert verification. When in doubt, throw it out!</p>
                    </div>

                    <h3 style="margin: 25px 0 15px;">Select Difficulty</h3>
                    <div class="difficulty-select">
                        <button class="difficulty-btn ${selectedDifficulty === 'all' ? 'active' : ''}" onclick="setDifficulty('all')">All (${mushrooms.length})</button>
                        <button class="difficulty-btn ${selectedDifficulty === '1' ? 'active' : ''}" onclick="setDifficulty('1')">Easy</button>
                        <button class="difficulty-btn ${selectedDifficulty === '2' ? 'active' : ''}" onclick="setDifficulty('2')">Hard</button>
                    </div>

                    <h3 style="margin: 25px 0 15px;">Game Mode</h3>
                    <div class="difficulty-select">
                        <button class="difficulty-btn ${!survivalMode && !speedMode ? 'active' : ''}" onclick="setGameMode('normal')">üéÆ Normal</button>
                        <button class="difficulty-btn ${survivalMode && !speedMode ? 'active' : ''}" onclick="setGameMode('survival')">‚ò†Ô∏è Survival</button>
                        <button class="difficulty-btn ${speedMode ? 'active' : ''}" onclick="setGameMode('speed')">‚ö° Speed</button>
                    </div>
                    ${survivalMode && !speedMode ? '<p style="color: #ff6b6b; font-size: 0.9rem; margin-top: 10px;">Survival: Misidentify a DEADLY mushroom = Game Over!</p>' : ''}
                    ${speedMode ? '<p style="color: #ffd700; font-size: 0.9rem; margin-top: 10px;">Speed: 10 seconds per question! ‚ö°</p>' : ''}

                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="play-again-btn" onclick="startGame()">Start Foraging! üçÑ</button>
                        <button class="play-again-btn" style="background: linear-gradient(90deg, #9c27b0, #7b1fa2);" onclick="startDailyChallenge()">
                            üìÜ Daily Challenge ${hasDoneDailyToday() ? '‚úì' : ''}
                        </button>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center; margin-top: 15px; flex-wrap: wrap;">
                        <button class="difficulty-btn" onclick="showCalendar()">üìÖ Calendar</button>
                        <button class="difficulty-btn" onclick="showStudyMode()">üìö Study</button>
                        <button class="difficulty-btn" onclick="showLookalikes()">‚ö†Ô∏è Lookalikes</button>
                        <button class="difficulty-btn" onclick="showAchievements()">üèÜ Achievements</button>
                        <button class="difficulty-btn" onclick="showForagingTips()">üí° Tips</button>
                    </div>
                    
                    <p style="color: #666; font-size: 0.8rem; margin-top: 15px;">Keyboard: 1-4 to answer, Enter for next, Esc for menu</p>
                    
                    ${highScores.length > 0 ? `
                        <div style="margin-top: 30px; text-align: left; max-width: 400px; margin-left: auto; margin-right: auto;">
                            <h4 style="color: #76b852; margin-bottom: 10px;">üèÜ High Scores</h4>
                            <table style="width: 100%; font-size: 0.9rem;">
                                ${highScores.map((s, i) => `
                                    <tr style="color: ${i === 0 ? '#ffd700' : '#aaa'};">
                                        <td>${i + 1}.</td>
                                        <td>${s.score} pts</td>
                                        <td>${s.mode || 'Normal'}</td>
                                        <td style="text-align: right;">${s.date}</td>
                                    </tr>
                                `).join('')}
                            </table>
                        </div>
                    ` : ''}
                </div>
            `;
        }

        function setSurvivalMode(enabled) {
            survivalMode = enabled;
            renderStartScreen();
        }

        function setGameMode(mode) {
            survivalMode = mode === 'survival';
            speedMode = mode === 'speed';
            renderStartScreen();
        }

        function showCalendar() {
            const currentMonth = new Date().getMonth();
            
            document.getElementById('app').innerHTML = `
                <div class="game-card">
                    <h2 style="text-align: center; margin-bottom: 20px;">üìÖ Michigan Foraging Calendar</h2>
                    <p style="text-align: center; color: #888; margin-bottom: 25px;">Best times to find each species in Southeast Michigan</p>
                    
                    <div style="overflow-x: auto;">
                        <table style="width: 100%; min-width: 600px; font-size: 0.8rem; border-collapse: collapse;">
                            <thead>
                                <tr style="background: rgba(255,255,255,0.1);">
                                    <th style="padding: 10px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.2);">Species</th>
                                    ${monthNames.map((m, i) => `
                                        <th style="padding: 5px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.2); ${i === currentMonth ? 'background: rgba(118,184,82,0.3);' : ''}">${m}</th>
                                    `).join('')}
                                </tr>
                            </thead>
                            <tbody>
                                ${mushrooms.filter(m => m.answer === 'edible' || m.answer === 'medicinal').map(m => {
                                    const seasons = m.season || getDefaultSeason(m.name);
                                    return `
                                        <tr>
                                            <td style="padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                                                <strong>${m.name}</strong>
                                                <span style="color: ${m.answer === 'edible' ? '#76b852' : '#9c27b0'}; font-size: 0.7rem; margin-left: 5px;">${m.answer === 'edible' ? '‚úì' : 'üíä'}</span>
                                            </td>
                                            ${monthNames.map((_, i) => `
                                                <td style="padding: 5px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); ${i === currentMonth ? 'background: rgba(118,184,82,0.1);' : ''}">
                                                    ${seasons.includes(i + 1) ? 'üçÑ' : '¬∑'}
                                                </td>
                                            `).join('')}
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>

                    <div style="text-align: center; margin-top: 20px;">
                        <p style="color: #76b852; margin-bottom: 15px;">Current month highlighted ‚Ä¢ ‚úì = Edible ‚Ä¢ üíä = Medicinal only</p>
                        <button class="next-btn" onclick="renderStartScreen()">‚Üê Back to Game</button>
                    </div>
                </div>
            `;
        }

        function getDefaultSeason(name) {
            // Default seasons for mushrooms without explicit season data
            const seasons = {
                'Morel': [4, 5],
                'Destroying Angel': [6, 7, 8, 9],
                'Chicken of the Woods': [8, 9, 10],
                'Jack O\'Lantern': [9, 10],
                'Giant Puffball': [8, 9, 10],
                'False Morel': [4, 5],
                'Chanterelle': [6, 7, 8, 9],
                'Fly Agaric': [8, 9, 10],
                'Hen of the Woods': [9, 10],
                'Death Cap': [8, 9, 10],
                'Oyster Mushroom': [4, 5, 10, 11],
                'Lion\'s Mane': [8, 9, 10],
                'Earthball': [7, 8, 9, 10],
                'Reishi': [6, 7, 8, 9, 10],
                'Shaggy Mane': [9, 10, 11],
                'Turkey Tail': [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]
            };
            return seasons[name] || [6, 7, 8, 9, 10];
        }

        function setDifficulty(diff) {
            selectedDifficulty = diff;
            renderStartScreen();
        }

        // Start game
        function startGame() {
            const availableMushrooms = getMushroomsByDifficulty();
            shuffledMushrooms = shuffle(availableMushrooms).slice(0, totalQuestions);
            currentMushroom = 0;
            score = 0;
            streak = 0;
            questionsAnswered = 0;
            gameOver = false;
            renderQuestion();
        }

        // Render question
        function renderQuestion() {
            stopTimer(); // Clear any existing timer
            const m = shuffledMushrooms[currentMushroom];
            const progress = ((currentMushroom) / shuffledMushrooms.length) * 100;
            
            document.getElementById('app').innerHTML = `
                <div class="stats-bar">
                    <div class="stat">
                        <div class="stat-value">${score}</div>
                        <div class="stat-label">Score</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${streak}üî•</div>
                        <div class="stat-label">Streak</div>
                    </div>
                    <div class="stat">
                        <div class="stat-value">${currentMushroom + 1}/${shuffledMushrooms.length}</div>
                        <div class="stat-label">Question</div>
                    </div>
                    ${speedMode ? `
                        <div class="stat">
                            <div class="stat-value" id="speed-timer">‚è±Ô∏è 10s</div>
                            <div class="stat-label">Time</div>
                        </div>
                    ` : ''}
                </div>

                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${progress}%"></div>
                </div>

                <div class="game-card">
                    <div class="mushroom-display">
                        <div class="mushroom-emoji">${m.emoji}</div>
                        <div class="mushroom-name">${m.name}</div>
                        <div class="mushroom-scientific">${m.scientific}</div>
                        <div class="mushroom-description">
                            <strong>Appearance:</strong> ${m.appearance}<br><br>
                            <strong>Habitat:</strong> ${m.habitat}
                        </div>
                    </div>

                    <div class="question">Is this mushroom safe to eat?</div>

                    <div class="choices">
                        <button class="choice-btn" onclick="checkAnswer('edible')">‚úÖ Edible</button>
                        <button class="choice-btn" onclick="checkAnswer('poisonous')">‚ò†Ô∏è Poisonous</button>
                        <button class="choice-btn" onclick="checkAnswer('deadly')">üíÄ Deadly</button>
                        <button class="choice-btn" onclick="checkAnswer('medicinal')">üíä Medicinal Only</button>
                    </div>

                    <div id="result" class="result-card"></div>
                </div>
            `;
            
            // Start timer in speed mode
            if (speedMode) {
                startTimer();
            }
        }

        // Check answer
        function checkAnswer(answer) {
            stopTimer(); // Stop speed mode timer
            vibrate([10]); // Haptic feedback
            const m = shuffledMushrooms[currentMushroom];
            const isCorrect = answer === m.answer;
            const ateFatal = !isCorrect && m.answer === 'deadly';
            
            // Disable buttons
            document.querySelectorAll('.choice-btn').forEach(btn => {
                btn.disabled = true;
                if (btn.textContent.toLowerCase().includes(m.answer)) {
                    btn.classList.add('correct');
                } else if (btn.textContent.toLowerCase().includes(answer) && !isCorrect) {
                    btn.classList.add('wrong');
                }
            });

            // Update score and stats
            const stats = getStats();
            if (isCorrect) {
                streak++;
                score += 10 + (streak * 2); // Bonus for streak
                stats.totalCorrect++;
                if (m.answer === 'deadly') {
                    stats.deadlyCorrect = (stats.deadlyCorrect || 0) + 1;
                }
            } else {
                streak = 0;
            }
            stats.maxStreak = Math.max(stats.maxStreak || 0, streak);
            stats.totalQuestions++;
            saveStats(stats);
            questionsAnswered++;

            // Play sound
            if (survivalMode && ateFatal) {
                playSound('death');
            } else if (isCorrect) {
                playSound('correct');
            } else {
                playSound('wrong');
            }

            // Check for survival mode death
            if (survivalMode && ateFatal) {
                gameOver = true;
                const resultDiv = document.getElementById('result');
                resultDiv.className = `result-card show wrong`;
                resultDiv.innerHTML = `
                    <div class="result-title" style="font-size: 2rem;">‚ò†Ô∏è YOU DIED ‚ò†Ô∏è</div>
                    <p style="font-size: 1.1rem; margin: 15px 0;">You ate a ${m.name} - it was <strong>DEADLY</strong>!</p>
                    <p style="color: #ff6b6b; font-style: italic;">"In the forest, there are old foragers and bold foragers, but no old, bold foragers."</p>
                    <div class="fun-fact">
                        <h4>üçÑ What killed you</h4>
                        <p>${m.funFact}</p>
                    </div>
                    <p style="margin-top: 20px; color: #888;">Final Score: <strong style="color: #76b852; font-size: 1.3rem;">${score}</strong> points</p>
                    <button class="next-btn" style="background: linear-gradient(90deg, #f44336, #d32f2f);" onclick="renderStartScreen()">Try Again (Don't eat that!) üíÄ</button>
                `;
                saveHighScore(score, 'Survival ‚ò†Ô∏è');
                return;
            }

            // Show result
            const resultDiv = document.getElementById('result');
            resultDiv.className = `result-card show ${isCorrect ? 'correct' : 'wrong'}`;
            resultDiv.innerHTML = `
                <div class="result-title">${isCorrect ? '‚úÖ Correct!' : '‚ùå Wrong!'}</div>
                <p>${isCorrect ? 'Great identification!' : `This is actually ${m.answer === 'deadly' ? 'DEADLY ‚ò†Ô∏è - you would have died!' : m.answer}.`}</p>
                <div class="fun-fact">
                    <h4>üçÑ Forager's Note</h4>
                    <p>${m.funFact}</p>
                </div>
                <button class="next-btn" onclick="nextQuestion()">${currentMushroom < shuffledMushrooms.length - 1 ? 'Next Mushroom ‚Üí' : 'See Results üèÜ'}</button>
            `;
        }

        // Next question
        function nextQuestion() {
            currentMushroom++;
            if (currentMushroom >= shuffledMushrooms.length) {
                showResults();
            } else {
                renderQuestion();
            }
        }

        // Show final results
        function showResults() {
            const percentage = Math.round((score / (shuffledMushrooms.length * 12)) * 100);
            let grade, gradeEmoji;
            
            if (percentage >= 90) {
                grade = "Master Mycologist";
                gradeEmoji = "üèÜ";
            } else if (percentage >= 70) {
                grade = "Expert Forager";
                gradeEmoji = "üåü";
            } else if (percentage >= 50) {
                grade = "Apprentice Hunter";
                gradeEmoji = "üçÑ";
            } else if (percentage >= 30) {
                grade = "Cautious Beginner";
                gradeEmoji = "üå±";
            } else {
                grade = "Stay Out of the Woods";
                gradeEmoji = "‚ò†Ô∏è";
            }

            // Save high score and update stats
            saveHighScore(score, survivalMode ? 'Survival üèÜ' : 'Normal');
            
            const stats = getStats();
            stats.gamesPlayed++;
            stats.highScore = Math.max(stats.highScore || 0, score);
            if (survivalMode) {
                stats.survivalWins = (stats.survivalWins || 0) + 1;
            }
            if (percentage >= 100) {
                stats.perfectGames = (stats.perfectGames || 0) + 1;
            }
            saveStats(stats);
            
            // Check for new achievements
            const newAchievements = checkAchievements();
            
            // Confetti for achievements or high scores
            if (newAchievements.length > 0 || percentage >= 80) {
                setTimeout(createConfetti, 100);
            }
            
            // Mark daily complete if this was daily challenge
            if (shuffledMushrooms === getDailyChallenge()) {
                markDailyComplete(score);
            }

            document.getElementById('app').innerHTML = `
                <div class="game-card game-over">
                    <h2>Hunt Complete! ${gradeEmoji}</h2>
                    <div class="final-score">${score}</div>
                    <p style="color: #888; margin-bottom: 20px;">points${survivalMode ? ' (Survival Mode!)' : ''}</p>
                    
                    <div class="grade">
                        <div class="grade-title">${grade}</div>
                        <p style="color: #888;">${percentage}% accuracy</p>
                    </div>

                    ${survivalMode ? `
                        <div style="background: rgba(76, 175, 80, 0.2); border: 1px solid rgba(76, 175, 80, 0.4); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                            <h4 style="color: #76b852;">üéâ Survival Bonus!</h4>
                            <p>You completed survival mode without eating anything deadly!</p>
                        </div>
                    ` : ''}

                    <div class="warning-box" style="margin-bottom: 30px;">
                        <h4>Remember!</h4>
                        <p>When foraging in the wild: "When in doubt, throw it out!" Always consult an expert before eating wild mushrooms.</p>
                    </div>

                    ${newAchievements.length > 0 ? `
                        <div style="background: rgba(255,215,0,0.2); border: 1px solid rgba(255,215,0,0.4); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                            <h4 style="color: #ffd700; margin-bottom: 10px;">üéâ New Achievement${newAchievements.length > 1 ? 's' : ''} Unlocked!</h4>
                            ${newAchievements.map(a => `
                                <div style="display: flex; align-items: center; gap: 10px; margin: 5px 0;">
                                    <span style="font-size: 1.5rem;">${a.icon}</span>
                                    <span><strong>${a.name}</strong> - ${a.desc}</span>
                                </div>
                            `).join('')}
                        </div>
                    ` : ''}

                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button class="play-again-btn" onclick="renderStartScreen()">Hunt Again üçÑ</button>
                        <button class="difficulty-btn" onclick="shareScore(${score}, '${survivalMode ? 'Survival' : speedMode ? 'Speed' : 'Normal'}')">üì§ Share Score</button>
                    </div>
                </div>
            `;
        }

        // Confetti effect
        function createConfetti() {
            const colors = ['#76b852', '#ffd700', '#ff6b6b', '#4ecdc4', '#9c27b0', '#ff9800'];
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 4000);
                }, i * 30);
            }
        }

        // Share score
        function shareScore(score, mode) {
            const date = new Date().toLocaleDateString();
            const emoji = score >= 100 ? 'üèÜ' : score >= 80 ? 'üåü' : score >= 50 ? 'üçÑ' : 'üå±';
            const text = `${emoji} Mushroom Hunter ${mode}\n` +
                        `Score: ${score} points\n` +
                        `Date: ${date}\n\n` +
                        `Can you beat my score? üçÑ\n` +
                        `https://wmiddendorff.github.io/mushroom-hunter/`;
            
            if (navigator.share) {
                navigator.share({ text }).catch(() => copyToClipboard(text));
            } else {
                copyToClipboard(text);
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                alert('Score copied to clipboard! üìã');
            }).catch(() => {
                alert('Share: ' + text);
            });
        }

        // Speed Round mode
        let speedMode = false;
        let timeLeft = 0;
        let timerInterval = null;

        function startTimer() {
            timeLeft = 10; // 10 seconds per question in speed mode
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    // Auto-wrong if time runs out
                    autoWrongAnswer();
                }
            }, 1000);
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        function updateTimerDisplay() {
            const timerEl = document.getElementById('speed-timer');
            if (timerEl) {
                timerEl.textContent = `‚è±Ô∏è ${timeLeft}s`;
                timerEl.className = timeLeft <= 3 ? 'timer-urgent' : '';
            }
        }

        function autoWrongAnswer() {
            // Pick a random wrong answer
            const m = shuffledMushrooms[currentMushroom];
            const wrongAnswers = ['edible', 'poisonous', 'deadly', 'medicinal'].filter(a => a !== m.answer);
            checkAnswer(wrongAnswers[0]);
        }

        // Keyboard controls
        document.addEventListener('keydown', (e) => {
            // Number keys for answering (1-4)
            if (document.querySelector('.choices') && !document.querySelector('.choice-btn:disabled')) {
                const keyMap = { '1': 'edible', '2': 'poisonous', '3': 'deadly', '4': 'medicinal' };
                if (keyMap[e.key]) {
                    checkAnswer(keyMap[e.key]);
                }
            }
            // Enter/Space for next question
            if ((e.key === 'Enter' || e.key === ' ') && document.querySelector('.next-btn')) {
                document.querySelector('.next-btn').click();
            }
            // Escape to go back
            if (e.key === 'Escape') {
                renderStartScreen();
            }
        });

        // Simple sound effects using Web Audio
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'correct') {
                oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
                oscillator.frequency.setValueAtTime(659.25, audioContext.currentTime + 0.1); // E5
                oscillator.frequency.setValueAtTime(783.99, audioContext.currentTime + 0.2); // G5
            } else if (type === 'wrong') {
                oscillator.frequency.setValueAtTime(311.13, audioContext.currentTime); // Eb4
                oscillator.frequency.setValueAtTime(233.08, audioContext.currentTime + 0.15); // Bb3
            } else if (type === 'death') {
                oscillator.frequency.setValueAtTime(196, audioContext.currentTime); // G3
                oscillator.frequency.setValueAtTime(146.83, audioContext.currentTime + 0.2); // D3
                oscillator.frequency.setValueAtTime(110, audioContext.currentTime + 0.4); // A2
            }
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        // Study Mode
        function showStudyMode() {
            const edible = mushrooms.filter(m => m.answer === 'edible');
            const poisonous = mushrooms.filter(m => m.answer === 'poisonous');
            const deadly = mushrooms.filter(m => m.answer === 'deadly');
            const medicinal = mushrooms.filter(m => m.answer === 'medicinal');
            
            document.getElementById('app').innerHTML = `
                <div class="game-card">
                    <h2 style="text-align: center; margin-bottom: 20px;">üìö Study Guide</h2>
                    <p style="text-align: center; color: #888; margin-bottom: 25px;">Learn all ${mushrooms.length} Michigan mushrooms</p>
                    
                    <div style="display: grid; gap: 20px;">
                        <div>
                            <h3 style="color: #76b852; margin-bottom: 10px;">‚úÖ Edible (${edible.length})</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px;">
                                ${edible.map(m => `
                                    <div style="background: rgba(76,175,80,0.1); padding: 10px; border-radius: 8px; cursor: pointer;" onclick="showMushroomDetail('${m.name}')">
                                        <div style="font-size: 2rem; text-align: center;">${m.emoji}</div>
                                        <div style="text-align: center; font-size: 0.9rem;">${m.name}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div>
                            <h3 style="color: #ff9800; margin-bottom: 10px;">‚ò†Ô∏è Poisonous (${poisonous.length})</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px;">
                                ${poisonous.map(m => `
                                    <div style="background: rgba(255,152,0,0.1); padding: 10px; border-radius: 8px; cursor: pointer;" onclick="showMushroomDetail('${m.name}')">
                                        <div style="font-size: 2rem; text-align: center;">${m.emoji}</div>
                                        <div style="text-align: center; font-size: 0.9rem;">${m.name}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div>
                            <h3 style="color: #f44336; margin-bottom: 10px;">üíÄ Deadly (${deadly.length})</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px;">
                                ${deadly.map(m => `
                                    <div style="background: rgba(244,67,54,0.1); padding: 10px; border-radius: 8px; cursor: pointer;" onclick="showMushroomDetail('${m.name}')">
                                        <div style="font-size: 2rem; text-align: center;">${m.emoji}</div>
                                        <div style="text-align: center; font-size: 0.9rem;">${m.name}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div>
                            <h3 style="color: #9c27b0; margin-bottom: 10px;">üíä Medicinal Only (${medicinal.length})</h3>
                            <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 10px;">
                                ${medicinal.map(m => `
                                    <div style="background: rgba(156,39,176,0.1); padding: 10px; border-radius: 8px; cursor: pointer;" onclick="showMushroomDetail('${m.name}')">
                                        <div style="font-size: 2rem; text-align: center;">${m.emoji}</div>
                                        <div style="text-align: center; font-size: 0.9rem;">${m.name}</div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 25px;">
                        <button class="next-btn" onclick="renderStartScreen()">‚Üê Back to Game</button>
                    </div>
                </div>
            `;
        }

        // Lookalike pairs - dangerous confusions
        const lookalikes = [
            {
                safe: 'Morel',
                dangerous: 'False Morel',
                safeEmoji: 'üçÑ',
                dangerEmoji: 'üçÑ',
                title: 'Morel vs False Morel',
                differences: [
                    { feature: 'Cap surface', safe: 'Honeycomb pits and ridges', dangerous: 'Brain-like wrinkles, no pits' },
                    { feature: 'Interior', safe: 'Completely hollow', dangerous: 'Chambered, cotton-like inside' },
                    { feature: 'Cap attachment', safe: 'Attached at bottom of cap', dangerous: 'Attached at top of cap' },
                    { feature: 'Color', safe: 'Tan to dark brown, uniform', dangerous: 'Reddish-brown, irregular' }
                ],
                tip: 'When in doubt, cut it lengthwise. True morels are completely hollow from top to bottom!'
            },
            {
                safe: 'Chanterelle',
                dangerous: 'Jack O\'Lantern',
                safeEmoji: 'üçÑ',
                dangerEmoji: 'üçÑ',
                title: 'Chanterelle vs Jack O\'Lantern',
                differences: [
                    { feature: 'Growth', safe: 'Grows singly from soil', dangerous: 'Grows in clusters on wood' },
                    { feature: 'Gills', safe: 'False gills (forked ridges)', dangerous: 'True gills (thin blades)' },
                    { feature: 'Smell', safe: 'Fruity, apricot-like', dangerous: 'Not particularly fragrant' },
                    { feature: 'Bioluminescence', safe: 'Does not glow', dangerous: 'Gills glow faintly in dark' }
                ],
                tip: 'Jack O\'Lanterns always grow in clusters at the base of trees. Chanterelles grow alone from soil!'
            },
            {
                safe: 'Giant Puffball',
                dangerous: 'Earthball',
                safeEmoji: '‚ö™',
                dangerEmoji: 'üü§',
                title: 'Giant Puffball vs Earthball',
                differences: [
                    { feature: 'Interior (young)', safe: 'Pure white, like marshmallow', dangerous: 'Dark purple-black marbling' },
                    { feature: 'Skin', safe: 'Thin, smooth, papery', dangerous: 'Thick, rubbery, warty' },
                    { feature: 'Size', safe: 'Can grow very large (1ft+)', dangerous: 'Usually smaller (1-4 inches)' },
                    { feature: 'Attachment', safe: 'Single thin cord to ground', dangerous: 'Broad attachment, root-like' }
                ],
                tip: 'ALWAYS cut puffballs in half! If it\'s not pure white inside, don\'t eat it.'
            },
            {
                safe: 'Oyster Mushroom',
                dangerous: 'Angel Wings',
                safeEmoji: 'üçÑ',
                dangerEmoji: 'üëº',
                title: 'Oyster vs Angel Wings',
                differences: [
                    { feature: 'Substrate', safe: 'Hardwoods (oak, beech, etc)', dangerous: 'Conifers (hemlock, pine)' },
                    { feature: 'Thickness', safe: 'Meaty, substantial', dangerous: 'Thin, translucent' },
                    { feature: 'Stem', safe: 'Has short offset stem', dangerous: 'No stem at all' },
                    { feature: 'Season', safe: 'Spring and fall', dangerous: 'Fall only' }
                ],
                tip: 'The #1 rule: Oysters grow on hardwoods, Angel Wings on conifers. Know your trees!'
            },
            {
                safe: 'Honey Mushroom',
                dangerous: 'Deadly Galerina',
                safeEmoji: 'üçØ',
                dangerEmoji: 'üçÑ',
                title: 'Honey Mushroom vs Deadly Galerina',
                differences: [
                    { feature: 'Size', safe: 'Medium to large caps', dangerous: 'Small caps (under 2 inches)' },
                    { feature: 'Ring', safe: 'Prominent white ring', dangerous: 'Faint, disappearing ring' },
                    { feature: 'Spore print', safe: 'White spores', dangerous: 'Rusty-brown spores' },
                    { feature: 'Cluster size', safe: 'Large dense clusters', dangerous: 'Small scattered clusters' }
                ],
                tip: 'ALWAYS do a spore print! Deadly Galerina has rusty-brown spores, Honey Mushrooms are white.'
            }
        ];

        function showLookalikes() {
            document.getElementById('app').innerHTML = `
                <div class="game-card">
                    <h2 style="text-align: center; margin-bottom: 10px;">‚ö†Ô∏è Deadly Lookalikes</h2>
                    <p style="text-align: center; color: #888; margin-bottom: 25px;">The most dangerous confusions in Michigan foraging</p>
                    
                    <div style="display: grid; gap: 15px;">
                        ${lookalikes.map((pair, i) => `
                            <div style="background: rgba(255,255,255,0.05); border-radius: 12px; padding: 15px; cursor: pointer; transition: all 0.2s;" 
                                 onclick="showLookalikeDetail(${i})"
                                 onmouseover="this.style.background='rgba(255,255,255,0.1)'"
                                 onmouseout="this.style.background='rgba(255,255,255,0.05)'">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <div style="text-align: center;">
                                        <div style="font-size: 2.5rem;">${pair.safeEmoji}</div>
                                        <div style="font-size: 0.8rem; color: #76b852;">‚úì Safe</div>
                                    </div>
                                    <div style="font-size: 1.5rem; color: #666;">vs</div>
                                    <div style="text-align: center;">
                                        <div style="font-size: 2.5rem;">${pair.dangerEmoji}</div>
                                        <div style="font-size: 0.8rem; color: #f44336;">‚ò†Ô∏è Danger</div>
                                    </div>
                                    <div style="flex: 1; text-align: right;">
                                        <div style="font-weight: bold;">${pair.title}</div>
                                        <div style="color: #888; font-size: 0.9rem;">Tap to learn differences ‚Üí</div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="text-align: center; margin-top: 25px;">
                        <button class="next-btn" onclick="renderStartScreen()">‚Üê Back to Game</button>
                    </div>
                </div>
            `;
        }

        function startDailyChallenge() {
            shuffledMushrooms = getDailyChallenge();
            currentMushroom = 0;
            score = 0;
            streak = 0;
            questionsAnswered = 0;
            gameOver = false;
            survivalMode = true; // Daily is always survival
            renderQuestion();
        }

        function showAchievements() {
            const earned = getAchievements();
            const stats = getStats();
            
            document.getElementById('app').innerHTML = `
                <div class="game-card">
                    <h2 style="text-align: center; margin-bottom: 20px;">üèÜ Achievements</h2>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px;">
                        ${achievementDefs.map(ach => {
                            const isEarned = earned.includes(ach.id);
                            return `
                                <div style="background: ${isEarned ? 'rgba(118,184,82,0.2)' : 'rgba(255,255,255,0.05)'}; 
                                            border: 1px solid ${isEarned ? 'rgba(118,184,82,0.4)' : 'rgba(255,255,255,0.1)'};
                                            border-radius: 10px; padding: 15px; text-align: center;
                                            opacity: ${isEarned ? 1 : 0.5};">
                                    <div style="font-size: 2rem; margin-bottom: 5px;">${ach.icon}</div>
                                    <div style="font-weight: bold; color: ${isEarned ? '#76b852' : '#888'};">${ach.name}</div>
                                    <div style="font-size: 0.8rem; color: #888;">${ach.desc}</div>
                                    ${isEarned ? '<div style="color: #76b852; font-size: 0.8rem; margin-top: 5px;">‚úì Unlocked</div>' : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                    
                    <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; margin-bottom: 20px;">
                        <h3 style="margin-bottom: 10px;">üìä Your Stats</h3>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 0.9rem;">
                            <div>Games Played: <strong>${stats.gamesPlayed}</strong></div>
                            <div>High Score: <strong>${stats.highScore}</strong></div>
                            <div>Survival Wins: <strong>${stats.survivalWins}</strong></div>
                            <div>Max Streak: <strong>${stats.maxStreak}</strong></div>
                            <div>Accuracy: <strong>${stats.totalQuestions > 0 ? Math.round(stats.totalCorrect / stats.totalQuestions * 100) : 0}%</strong></div>
                            <div>Total Correct: <strong>${stats.totalCorrect}</strong></div>
                        </div>
                    </div>
                    
                    <div style="text-align: center;">
                        <button class="next-btn" onclick="renderStartScreen()">‚Üê Back</button>
                    </div>
                </div>
            `;
        }

        function showForagingTips() {
            const tips = [
                { icon: 'üß∫', title: 'Basket vs Bag', tip: 'Use a mesh bag or basket to carry mushrooms - this allows spores to spread and helps mushrooms "breathe." Plastic bags cause them to deteriorate quickly.' },
                { icon: 'üî™', title: 'Cut, Don\'t Pull', tip: 'Cut mushrooms at the base with a knife rather than pulling. This preserves the mycelium network underground and allows future fruiting.' },
                { icon: 'üì∏', title: 'Document Everything', tip: 'Take photos of mushrooms in situ before picking: top, gills, stem, and surrounding habitat. Note the tree species nearby. This helps with later ID.' },
                { icon: 'üåßÔ∏è', title: 'Best Conditions', tip: 'Mushrooms fruit 2-5 days after rain when temperatures are mild. Morning hunts in humid conditions are often most productive.' },
                { icon: 'üß™', title: 'Spore Prints', tip: 'Always do a spore print for ID: place cap gill-side down on paper overnight. Spore color is a key identification feature.' },
                { icon: 'ü§¢', title: 'The Universal Edibility Test is a MYTH', tip: 'There is NO reliable test to determine if a mushroom is safe. Cooking, silver spoons, and animal tests don\'t work. Only expert ID is safe.' },
                { icon: '‚è∞', title: 'Timing is Everything', tip: 'Morels: April-May after warm rains. Chanterelles: July-September. Hen of Woods: September-October. Know your seasons!' },
                { icon: 'üå≥', title: 'Tree Relationships', tip: 'Most prized edibles have specific tree partners. Morels love dying elms/ash. Chanterelles like oaks. Hen of Woods grows at oak bases.' },
                { icon: 'üë•', title: 'Join a Club', tip: 'Michigan has excellent mycological societies. Join one! Learning from experienced foragers is the safest way to start. Never eat anything without expert confirmation.' },
                { icon: 'üö´', title: 'When in Doubt...', tip: '...THROW IT OUT. No mushroom is worth dying for. Even experienced foragers make mistakes. Always err on the side of caution.' },
            ];
            
            document.getElementById('app').innerHTML = `
                <div class="game-card">
                    <h2 style="text-align: center; margin-bottom: 20px;">üí° Foraging Tips</h2>
                    <p style="text-align: center; color: #888; margin-bottom: 25px;">Essential knowledge for safe mushroom hunting</p>
                    
                    <div style="display: grid; gap: 15px;">
                        ${tips.map(tip => `
                            <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; display: flex; gap: 15px; align-items: start;">
                                <div style="font-size: 2rem; flex-shrink: 0;">${tip.icon}</div>
                                <div>
                                    <h4 style="color: #76b852; margin-bottom: 5px;">${tip.title}</h4>
                                    <p style="color: #ccc; font-size: 0.9rem; line-height: 1.5;">${tip.tip}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="background: rgba(244,67,54,0.2); border: 1px solid rgba(244,67,54,0.4); border-radius: 10px; padding: 15px; margin-top: 20px; text-align: center;">
                        <h4 style="color: #f44336;">‚ö†Ô∏è This is a Game</h4>
                        <p style="color: #ddd; font-size: 0.9rem;">This game is for education and entertainment only. NEVER eat wild mushrooms without expert verification. Even slight misidentification can be fatal.</p>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px;">
                        <button class="next-btn" onclick="renderStartScreen()">‚Üê Back</button>
                    </div>
                </div>
            `;
        }

        function showLookalikeDetail(index) {
            const pair = lookalikes[index];
            const safeMushroom = mushrooms.find(m => m.name === pair.safe);
            const dangerMushroom = mushrooms.find(m => m.name === pair.dangerous);
            
            document.getElementById('app').innerHTML = `
                <div class="game-card">
                    <h2 style="text-align: center; margin-bottom: 20px;">${pair.title}</h2>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 25px;">
                        <div style="background: rgba(76,175,80,0.1); border-radius: 12px; padding: 15px; text-align: center;">
                            <div style="font-size: 4rem; margin-bottom: 10px;">${pair.safeEmoji}</div>
                            <h3 style="color: #76b852;">${pair.safe}</h3>
                            <span style="background: #76b852; color: #fff; padding: 3px 10px; border-radius: 10px; font-size: 0.8rem;">EDIBLE</span>
                        </div>
                        <div style="background: rgba(244,67,54,0.1); border-radius: 12px; padding: 15px; text-align: center;">
                            <div style="font-size: 4rem; margin-bottom: 10px;">${pair.dangerEmoji}</div>
                            <h3 style="color: #f44336;">${pair.dangerous}</h3>
                            <span style="background: #f44336; color: #fff; padding: 3px 10px; border-radius: 10px; font-size: 0.8rem;">DANGER</span>
                        </div>
                    </div>
                    
                    <h3 style="margin-bottom: 15px;">üîç Key Differences</h3>
                    <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                        <thead>
                            <tr style="background: rgba(255,255,255,0.1);">
                                <th style="padding: 10px; text-align: left;">Feature</th>
                                <th style="padding: 10px; text-align: left; color: #76b852;">${pair.safe}</th>
                                <th style="padding: 10px; text-align: left; color: #f44336;">${pair.dangerous}</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${pair.differences.map(d => `
                                <tr style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                                    <td style="padding: 10px; font-weight: bold;">${d.feature}</td>
                                    <td style="padding: 10px; color: #aaa;">${d.safe}</td>
                                    <td style="padding: 10px; color: #aaa;">${d.dangerous}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                    
                    <div style="background: rgba(255,152,0,0.2); border: 1px solid rgba(255,152,0,0.4); border-radius: 10px; padding: 15px;">
                        <h4 style="color: #ff9800; margin-bottom: 8px;">üí° Pro Tip</h4>
                        <p style="color: #ddd;">${pair.tip}</p>
                    </div>
                    
                    <div style="text-align: center; margin-top: 25px;">
                        <button class="difficulty-btn" onclick="showLookalikes()">‚Üê All Lookalikes</button>
                        <button class="next-btn" style="margin-left: 10px;" onclick="renderStartScreen()">Play Game</button>
                    </div>
                </div>
            `;
        }

        function showMushroomDetail(name) {
            const m = mushrooms.find(m => m.name === name);
            if (!m) return;
            
            // Track for Scholar achievement
            const viewed = JSON.parse(localStorage.getItem('mushroomsViewed') || '[]');
            if (!viewed.includes(name)) {
                viewed.push(name);
                localStorage.setItem('mushroomsViewed', JSON.stringify(viewed));
                const stats = getStats();
                stats.mushroomsViewed = viewed.length;
                saveStats(stats);
            }
            
            const categoryColors = {
                'edible': '#76b852',
                'poisonous': '#ff9800',
                'deadly': '#f44336',
                'medicinal': '#9c27b0'
            };
            
            document.getElementById('app').innerHTML = `
                <div class="game-card">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <div style="font-size: 6rem; margin-bottom: 10px;">${m.emoji}</div>
                        <h2>${m.name}</h2>
                        <p style="font-style: italic; color: #888;">${m.scientific}</p>
                        <span style="display: inline-block; padding: 5px 15px; border-radius: 20px; margin-top: 10px; background: ${categoryColors[m.answer]}33; color: ${categoryColors[m.answer]}; font-weight: bold;">
                            ${m.answer.toUpperCase()}
                        </span>
                    </div>
                    
                    <div style="max-width: 600px; margin: 0 auto;">
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #76b852; margin-bottom: 8px;">üîç Appearance</h4>
                            <p style="color: #ccc; line-height: 1.6;">${m.appearance}</p>
                        </div>
                        
                        <div style="margin-bottom: 20px;">
                            <h4 style="color: #76b852; margin-bottom: 8px;">üìç Habitat & Season</h4>
                            <p style="color: #ccc; line-height: 1.6;">${m.habitat}</p>
                        </div>
                        
                        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;">
                            <h4 style="color: #76b852; margin-bottom: 8px;">üçÑ Forager's Note</h4>
                            <p style="color: #ccc; line-height: 1.6;">${m.funFact}</p>
                        </div>
                    </div>
                    
                    <div style="text-align: center; margin-top: 25px;">
                        <button class="difficulty-btn" onclick="showStudyMode()">‚Üê All Mushrooms</button>
                        <button class="next-btn" style="margin-left: 10px;" onclick="renderStartScreen()">Play Game</button>
                    </div>
                </div>
            `;
        }

        // Initialize
        renderStartScreen();

        // Register Service Worker for offline support
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js')
                .then(reg => console.log('üçÑ Mushroom Hunter ready for offline!'))
                .catch(err => console.log('SW registration failed:', err));
        }

        // Install prompt for PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            showInstallButton();
        });

        function showInstallButton() {
            const existing = document.getElementById('install-prompt');
            if (existing) return;
            
            const btn = document.createElement('div');
            btn.id = 'install-prompt';
            btn.innerHTML = `
                <div style="position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); 
                            background: linear-gradient(90deg, #76b852, #8dc26f); 
                            padding: 12px 25px; border-radius: 25px; cursor: pointer;
                            box-shadow: 0 4px 15px rgba(118,184,82,0.3); z-index: 1000;
                            display: flex; align-items: center; gap: 10px;"
                     onclick="installApp()">
                    <span style="font-size: 1.2rem;">üì±</span>
                    <span style="color: #fff; font-weight: bold;">Install App</span>
                </div>
            `;
            document.body.appendChild(btn);
        }

        function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(choice => {
                    if (choice.outcome === 'accepted') {
                        console.log('App installed!');
                    }
                    deferredPrompt = null;
                    const btn = document.getElementById('install-prompt');
                    if (btn) btn.remove();
                });
            }
        }

        // Haptic feedback for mobile
        function vibrate(pattern = [10]) {
            if ('vibrate' in navigator) {
                navigator.vibrate(pattern);
            }
        }

        // ========= EASTER EGGS =========
        
        // Konami Code: ‚Üë‚Üë‚Üì‚Üì‚Üê‚Üí‚Üê‚ÜíBA unlocks "Psychedelic Mode"
        let konamiCode = [];
        const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'KeyB', 'KeyA'];
        
        document.addEventListener('keydown', (e) => {
            konamiCode.push(e.code);
            konamiCode = konamiCode.slice(-10);
            
            if (konamiCode.join(',') === konamiSequence.join(',')) {
                activatePsychedelicMode();
            }
        });
        
        function activatePsychedelicMode() {
            playSound('achievement');
            createConfetti();
            document.body.style.animation = 'rainbow 2s infinite';
            
            // Add rainbow animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes rainbow {
                    0% { filter: hue-rotate(0deg); }
                    100% { filter: hue-rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
            
            // Show secret mushroom discovery
            alert('üçÑ‚ú® SECRET UNLOCKED: Psychedelic Mode! ‚ú®üçÑ\n\nYou found the Konami Code Easter egg!\n\nFun fact: Psilocybin mushrooms have been used for thousands of years in spiritual ceremonies. Modern research shows promise for treating depression and PTSD.\n\n(This is just a visual effect, not an endorsement!)');
        }
        
        // Secret: Click the title 7 times for "Expert Mode"
        let titleClicks = 0;
        document.querySelector('header h1')?.addEventListener('click', () => {
            titleClicks++;
            if (titleClicks === 7) {
                alert('üßô EXPERT MODE UNLOCKED!\n\nAll mushrooms now available at max difficulty!\n\n"Every expert was once a beginner"\n- Helen Hayes');
                difficulty = 3;
                renderStartScreen();
            }
        });
        
        // Secret: Type "fungus" anywhere to get a fun fact
        let typedChars = '';
        document.addEventListener('keypress', (e) => {
            typedChars += e.key.toLowerCase();
            typedChars = typedChars.slice(-10);
            
            if (typedChars.includes('fungus')) {
                typedChars = '';
                showFungusFact();
            }
        });
        
        function showFungusFact() {
            const funFacts = [
                "üçÑ The largest organism on Earth is a honey fungus in Oregon spanning 2,385 acres!",
                "üå≥ 90% of plants depend on mycorrhizal fungi for nutrient absorption!",
                "üß† Some fungi can control ant brains - the 'zombie ant' fungus!",
                "üî¨ Penicillin comes from a fungus - it's saved over 200 million lives!",
                "üåç There are an estimated 3.8 million fungal species, but only 120,000 are described!",
                "üíÄ The Death Cap is responsible for over 90% of mushroom fatalities worldwide!",
                "ü¶† Fungi are more closely related to animals than to plants!",
                "üçï Yeast is a fungus - no fungi, no bread or beer!",
                "üå≤ A single mushroom can release 16 BILLION spores!",
                "üî• Some fungi glow in the dark - it's called bioluminescence!"
            ];
            alert(funFacts[Math.floor(Math.random() * funFacts.length)]);
        }
        
        // Birthday Easter egg
        const today = new Date();
        if (today.getMonth() === 3 && today.getDate() === 22) { // Earth Day
            console.log('üåç Happy Earth Day! Thank you for learning about fungi!');
        }
        if (today.getMonth() === 8 && today.getDate() === 15) { // National Mushroom Day
            console.log('üçÑ Happy National Mushroom Day!');
            setTimeout(() => alert('üçÑ Happy National Mushroom Day! (September 15)\n\nGo find some mushrooms today!'), 1000);
        }
    </script>
</body>
</html>
